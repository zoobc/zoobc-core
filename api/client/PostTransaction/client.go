package main

import (
	"context"
	"fmt"
	"os"
	"strings"

	"github.com/sirupsen/logrus"
	log "github.com/sirupsen/logrus"
	"github.com/spf13/viper"
	rpc_model "github.com/zoobc/zoobc-core/common/model"
	rpc_service "github.com/zoobc/zoobc-core/common/service"
	"github.com/zoobc/zoobc-core/common/util"
	"google.golang.org/grpc"
)

func main() {

	var (
		apiRPCPort int
		configPath = "./resource"
	)
	dir, _ := os.Getwd()
	if strings.Contains(dir, "api") {
		configPath = "../../../resource"
	}
	if err := util.LoadConfig(configPath, "config", "toml"); err != nil {
		logrus.Fatal(err)
	} else {
		apiRPCPort = viper.GetInt("apiRPCPort")
		if apiRPCPort == 0 {
			apiRPCPort = 8080
		}
	}

	conn, err := grpc.Dial(fmt.Sprintf(":%d", apiRPCPort), grpc.WithInsecure())
	if err != nil {
		log.Fatalf("did not connect: %s", err)
	}
	defer conn.Close()

	c := rpc_service.NewTransactionServiceClient(conn)

	response, err := c.PostTransaction(context.Background(), &rpc_model.PostTransactionRequest{
		// Remove node registration
		//TransactionBytes: []byte{2, 2, 0, 0, 1, 234, 112, 141, 93, 0, 0, 0, 0, 44, 0, 0, 0, 66, 67,
		//	90, 69, 71, 79, 98, 51, 87, 78, 120, 51, 102, 68, 79, 86, 102, 57, 90, 83, 52, 69, 106,
		//	118, 79, 73, 118, 95, 85, 101, 87, 52, 84, 86, 66, 81, 74, 95, 54, 116, 72, 75, 108, 69,
		//	44, 0, 0, 0, 66, 67, 90, 69, 71, 79, 98, 51, 87, 78, 120, 51, 102, 68, 79, 86, 102, 57,
		//	90, 83, 52, 69, 106, 118, 79, 73, 118, 95, 85, 101, 87, 52, 84, 86, 66, 81, 74, 95, 54,
		//	116, 72, 75, 108, 69, 1, 0, 0, 0, 0, 0, 0, 0, 32, 0, 0, 0, 153, 58, 50, 200, 7, 61, 108,
		//	229, 204, 48, 199, 145, 21, 99, 125, 75, 49, 45, 118, 97, 219, 80, 242, 244, 100, 134,
		//	144, 246, 37, 144, 213, 135, 0, 0, 0, 0, 198, 233, 202, 223, 179, 244, 150, 151, 79,
		//	110, 147, 215, 52, 110, 180, 63, 52, 9, 206, 82, 172, 121, 167, 64, 9, 209, 95, 23, 68,
		//	5, 94, 110, 64, 188, 165, 254, 244, 196, 203, 245, 29, 248, 12, 97, 225, 180, 66, 130,
		//	187, 42, 93, 161, 96, 224, 21, 157, 27, 131, 44, 248, 142, 131, 24, 13},
		// TransactionBytes: []byte{
		// 	1, 0, 0, 0, 1, 210, 225, 121, 93, 0, 0, 0, 0, 44, 0, 0, 0, 110, 75, 95, 111, 117, 120, 100, 68,
		// 	68, 119, 117, 74, 105, 111, 103, 105, 68, 65, 105, 95, 122, 115, 49, 76, 113, 101, 78, 55, 102,
		// 	53, 90, 115, 88, 98, 70, 116, 88, 71, 113, 71, 99, 48, 80, 100, 44, 0, 0, 0, 118, 66, 75, 98,
		// 	114, 82, 53, 89, 57, 83, 71, 68, 74, 51, 50, 49, 76, 119, 53, 53, 50, 119, 53, 106, 85, 50, 76,
		// 	109, 79, 81, 67, 68, 120, 81, 114, 114, 118, 74, 48, 67, 85, 107, 101, 70, 160, 134, 1, 0, 0,
		// 	0, 0, 0, 8, 0, 0, 0, 0, 225, 245, 5, 0, 0, 0, 0, 0, 0, 0, 0, 109, 6, 82, 80, 77, 171, 32, 88,
		// 	211, 199, 11, 114, 75, 229, 243, 98, 167, 159, 225, 11, 40, 125, 221, 252, 44, 131, 136, 13,
		// 	104, 109, 228, 40, 27, 177, 175, 128, 223, 154, 19, 71, 18, 134, 177, 77, 96, 157, 187, 91,
		// 	152, 160, 78, 140, 96, 81, 116, 38, 164, 105, 149, 50, 138, 236, 209, 11},
		// add node
		// TransactionBytes: []byte{
		//	2, 0, 0, 0, 1, 77, 2, 85, 93, 0, 0, 0, 0, 44, 0, 0, 0, 66, 67, 90, 110, 83, 102, 113, 112, 80, 53, 116, 113, 70, 81, 108,
		//	77, 84, 89, 107, 68, 101, 66, 86, 70, 87, 110, 98, 121, 86, 75, 55, 118, 76, 114, 53, 79, 82, 70, 112, 84, 106, 103, 116,
		//	78, 44, 0, 0, 0, 66, 67, 90, 75, 76, 118, 103, 85, 89, 90, 49, 75, 75, 120, 45, 106, 116, 70, 57, 75, 111, 74, 115, 107,
		//	106, 86, 80, 118, 66, 57, 106, 112, 73, 106, 102, 122, 122, 73, 54, 122, 68, 87, 48, 74, 1, 0, 0, 0, 0, 0, 0, 0, 179, 0,
		//	0, 0, 0, 14, 6, 218, 170, 54, 60, 50, 2, 66, 130, 119, 226, 235, 126, 203, 5, 12, 152, 194, 170, 146, 43, 63, 224, 101,
		//	127, 241, 62, 152, 187, 255, 44, 0, 0, 0, 66, 67, 90, 110, 83, 102, 113, 112, 80, 53, 116, 113, 70, 81, 108, 77, 84, 89,
		//	107, 68, 101, 66, 86, 70, 87, 110, 98, 121, 86, 75, 55, 118, 76, 114, 53, 79, 82, 70, 112, 84, 106, 103, 116, 78, 9, 0, 0,
		//	0, 49, 50, 55, 46, 48, 46, 48, 46, 49, 160, 134, 1, 0, 0, 0, 0, 0, 72, 101, 108, 108, 111, 66, 108, 111, 99, 107, 0, 0, 0, 0,
		//	199, 197, 72, 124, 13, 17, 101, 202, 66, 255, 200, 80, 230, 26, 232, 97, 114, 251, 243, 2, 160, 39, 241, 127, 134, 183, 154,
		//	155, 151, 223, 41, 5, 43, 100, 106, 180, 105, 192, 249, 103, 238, 62, 74, 180, 114, 42, 210, 236, 201, 241, 198, 237, 233, 66, 198,
		//	203, 18, 201, 201, 61, 39, 167, 91, 10, 229, 148, 34, 207, 159, 48, 187, 20, 133, 227, 205, 56, 234, 23, 245, 89, 41, 246, 210, 194,
		//	132, 107, 152, 95, 198, 96, 238, 88, 8, 76, 24, 42, 139, 71, 249, 178, 252, 59, 30, 57, 74, 146, 163, 211, 36, 110, 221, 219, 218,
		//	57, 63, 79, 55, 216, 214, 139, 85, 125, 62, 129, 158, 16, 108, 3,
		// },
		// Add NodeRegWithPort
		//TransactionBytes: []byte{2, 0, 0, 0, 1, 92, 4, 159, 93, 0, 0, 0, 0, 44, 0, 0, 0, 66, 67, 90, 69, 71, 79, 98, 51, 87, 78, 120, 51,
		// 102, 68, 79, 86, 102, 57, 90, 83, 52, 69, 106, 118, 79, 73, 118, 95, 85, 101, 87, 52, 84, 86, 66, 81, 74, 95, 54, 116, 72, 75,
		// 108, 69, 44, 0, 0, 0, 66, 67, 90, 69, 71, 79, 98, 51, 87, 78, 120, 51, 102, 68, 79, 86, 102, 57, 90, 83, 52, 69, 106, 118, 79,
		// 73, 118, 95, 85, 101, 87, 52, 84, 86, 66, 81, 74, 95, 54, 116, 72, 75, 108, 69, 1, 0, 0, 0, 0, 0, 0, 0, 252, 0, 0, 0, 153, 47, 177,
		// 174, 224, 27, 128, 12, 115, 218, 191, 233, 228, 245, 16, 62, 85, 183, 5, 47, 186, 78, 31, 45, 127, 29, 155, 9, 5, 175, 255, 40, 44,
		// 0, 0, 0, 86, 90, 118, 89, 100, 56, 48, 112, 53, 83, 45, 114, 120, 83, 78, 81, 109, 77, 90, 119, 89, 88, 67, 55, 76, 121, 65, 122, 66,
		// 109, 99, 102, 99, 106, 52, 77, 85, 85, 65, 100, 117, 100, 87, 77, 16, 0, 0, 0, 50, 51, 46, 50, 51, 46, 50, 51, 46, 50, 51, 58, 56, 48,
		// 56, 48, 0, 202, 154, 59, 0, 0, 0, 0, 86, 90, 118, 89, 100, 56, 48, 112, 53, 83, 45, 114, 120, 83, 78, 81, 109, 77, 90, 119, 89, 88, 67,
		// 55, 76, 121, 65, 122, 66, 109, 99, 102, 99, 106, 52, 77, 85, 85, 65, 100, 117, 100, 87, 77, 157, 51, 82, 115, 27, 163, 55, 163, 181,
		// 183, 99, 18, 239, 69, 108, 126, 54, 175, 105, 169, 116, 108, 147, 67, 165, 130, 72, 216, 26, 25, 165, 68, 97, 0, 0, 0, 152, 152, 215,
		// 38, 114, 81, 134, 86, 91, 221, 156, 148, 175, 183, 93, 184, 62, 94, 113, 179, 187, 5, 189, 45, 158, 199, 47, 76, 8, 126, 198, 102,
		// 199, 244, 150, 190, 113, 175, 246, 91, 72, 68, 101, 169, 42, 253, 124, 48, 59, 8, 245, 41, 105, 38, 96, 105, 52, 64, 151, 222, 53,
		// 104, 165, 2, 0, 0, 0, 0, 61, 143, 6, 211, 90, 91, 119, 233, 142, 43, 21, 10, 6, 61, 206, 144, 158, 76, 49, 108, 181, 246, 166,
		// 144, 34, 85, 82, 168, 66, 55,  191, 74, 75, 2, 245, 81, 130, 61, 150, 85, 78, 125, 89, 248, 179, 164, 83, 227, 11, 120, 111,
		// 117, 109, 64, 235, 6, 117, 103, 57, 95,  172, 157, 7, 10},
		// Add NodeRegInvalidPort
		TransactionBytes: []byte{2, 0, 0, 0, 1, 112, 240, 249, 74, 0, 0, 0, 0, 44, 0, 0, 0, 66, 67, 90, 69, 71, 79, 98, 51, 87, 78, 120,
			51, 102, 68, 79, 86, 102, 57, 90, 83, 52, 69, 106, 118, 79, 73, 118, 95, 85, 101, 87, 52, 84, 86, 66, 81, 74, 95, 54, 116,
			72, 75, 108, 69, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
			0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 201, 0, 0, 0, 153, 58, 50, 200, 7, 61, 108, 229, 204, 48,
			199, 145, 21, 99, 125, 75, 49, 45, 118, 97, 219, 80, 242, 244, 100, 134, 144, 246, 37, 144, 213, 135, 0, 0, 0, 0, 9, 0, 0,
			0, 49, 50, 55, 46, 48, 46, 48, 46, 49, 0, 202, 154, 59, 0, 0, 0, 0, 86, 90, 118, 89, 100, 56, 48, 112, 53, 83, 45, 114, 120,
			83, 78, 81, 109, 77, 90, 119, 89, 88, 67, 55, 76, 121, 65, 122, 66, 109, 99, 102, 99, 106, 52, 77, 85, 85, 65, 100, 117, 100,
			87, 77, 209, 64, 140, 231, 150, 96, 104, 137, 202, 190, 83, 202, 22, 67, 222, 38, 48, 40, 213, 202, 144, 30, 73, 184, 186, 188,
			240, 209, 252, 222, 132, 36, 1, 0, 0, 0, 56, 228, 235, 51, 192, 162, 164, 174, 155, 149, 7, 230, 209, 204, 108, 163, 160, 249,
			43, 214, 101, 6, 163, 211, 245, 22, 172, 179, 55, 177, 238, 237, 238, 56, 98, 159, 107, 184, 115, 156, 212, 192, 146, 164, 219,
			43, 22, 11, 110, 246, 186, 131, 176, 243, 45, 2, 77, 250, 48, 26, 172, 181, 248, 14, 0, 0, 0, 0, 4, 51, 103, 245, 227, 93, 168,
			174, 184, 78, 71, 118, 33, 16, 234, 200, 108, 11, 194, 138, 66, 125, 125, 121, 246, 12, 134, 31, 91, 51, 188, 24, 98, 79, 100,
			120, 182, 196, 215, 67, 55, 95, 103, 47, 153, 22, 0, 101, 18, 83, 98, 176, 198, 35, 253, 96, 65, 103, 53, 216, 78, 113, 5, 15},
		// setup Dataset
		// TransactionBytes: []byte{
		// 	3, 0, 0, 0, 1, 92, 108, 83, 93, 0, 0, 0, 0, 44, 0, 0, 0, 66, 67, 90, 110, 83, 102, 113, 112, 80, 53, 116, 113, 70, 81, 108,
		// 	77, 84, 89, 107, 68, 101, 66, 86, 70, 87, 110, 98, 121, 86, 75, 55, 118, 76, 114, 53, 79, 82, 70, 112, 84, 106, 103, 116,
		// 	78, 44, 0, 0, 0, 66, 67, 90, 75, 76, 118, 103, 85, 89, 90, 49, 75, 75, 120, 45, 106, 116, 70, 57, 75, 111, 74, 115, 107, 106,
		// 	86, 80, 118, 66, 57, 106, 112, 73, 106, 102, 122, 122, 73, 54, 122, 68, 87, 48, 74, 1, 0, 0, 0, 0, 0, 0, 0, 131, 0, 0, 0,
		// 	44, 0, 0, 0, 66, 67, 90, 110, 83, 102, 113, 112, 80, 53, 116, 113, 70, 81, 108, 77, 84, 89, 107, 68, 101, 66, 86, 70, 87,
		// 	110, 98, 121, 86, 75, 55, 118, 76, 114, 53, 79, 82, 70, 112, 84, 106, 103, 116, 78, 44, 0, 0, 0, 66, 67, 90, 75, 76, 118, 103,
		// 	85, 89, 90, 49, 75, 75, 120, 45, 106, 116, 70, 57, 75, 111, 74, 115, 107, 106, 86, 80, 118, 66, 57, 106, 112, 73, 106, 102,
		// 	122, 122, 73, 54, 122, 68, 87, 48, 74, 5, 0, 0, 0, 65, 100, 109, 105, 110, 14, 0, 0, 0, 121, 111, 117, 114, 32, 97, 114, 101,
		// 	32, 97, 100, 109, 105, 110, 0, 141, 39, 0, 0, 0, 0, 0, 49, 195, 165, 218, 129, 183, 199, 241, 41, 12, 132, 139, 76, 252, 226,
		// 	91, 5, 96, 72, 140, 247, 72, 100, 67, 148, 188, 226, 179, 71, 94, 87, 191, 147, 220, 243, 199, 102, 104, 155, 203, 82, 23,
		// 	255, 170, 37, 39, 65, 195, 54, 30, 184, 46, 230, 222, 62, 138, 79, 69, 22, 191, 34, 9, 81, 4,
		// },
	})

	if err != nil {
		log.Fatalf("error calling rpc_service.PostTransaction: %s", err)
	}

	log.Printf("response from remote rpc_service.PostTransaction(): %s", response)

}
